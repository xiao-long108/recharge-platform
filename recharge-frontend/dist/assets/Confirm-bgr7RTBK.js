import{d as D,u as U,r as u,D as z,x as A,v as F,h as M,c as b,b as t,z as R,e as a,i as v,L as S,t as l,w as f,J as T,B as L,M as W,o as w,K as $,f as j,j as q,k as m}from"./index-4bcZGDoL.js";import{g as E,p as J}from"./order-BCzdytcL.js";import{W as K}from"./WalletOutlined-Cls6Aq2s.js";import"./request-C-LQhwRX.js";const G={class:"page-container !pb-28"},H={class:"flex items-center bg-primary text-white p-4"},Q={key:0,class:"card-box m-3"},X={class:"list-item"},Y={class:"text-foreground"},Z={class:"list-item"},ee={class:"text-foreground"},te={class:"list-item"},se={class:"text-foreground"},oe={class:"list-item"},ae={class:"text-destructive text-lg font-bold"},ne={class:"card-box m-3"},le={class:"flex items-center"},re={class:"text-muted-foreground text-xs ml-2"},ue={class:"fixed bottom-0 left-0 right-0 bg-card p-3 flex items-center shadow-[0_-2px_10px_rgba(0,0,0,0.05)]"},de={class:"flex-1"},ie={class:"text-destructive text-xl font-bold"},xe=D({__name:"Confirm",setup(pe){const d=M(),k=F(),x=U(),s=u(null),i=u(1),p=u(!1),c=u(!1),r=u(""),_=z(()=>{var o;return((o=x.userInfo)==null?void 0:o.balance)||0});A(async()=>{const o=Number(k.query.orderId);o&&await h(o)});async function h(o){try{s.value=await E(o)}catch{d.back()}}function N(){var o;if(s.value){if(i.value===1&&_.value<s.value.payAmount){m.error("余额不足");return}if(!((o=x.userInfo)!=null&&o.hasPayPassword)){m.error("请先设置支付密码"),d.push("/profile/settings");return}c.value=!0}}async function P(){if(s.value){if(!r.value||r.value.length!==6){m.error("请输入6位支付密码");return}p.value=!0;try{await J({orderId:s.value.id,payType:i.value,payPassword:r.value}),m.success("支付成功"),c.value=!1,d.push(`/order/${s.value.id}`)}catch{}finally{p.value=!1}}}return(o,e)=>{var g,y;const B=$,C=T,O=L,I=q,V=W;return w(),b("div",G,[t("div",H,[a(v(S),{class:"text-xl cursor-pointer",onClick:e[0]||(e[0]=n=>v(d).back())}),e[4]||(e[4]=t("span",{class:"flex-1 text-center text-lg font-bold"},"确认订单",-1)),e[5]||(e[5]=t("span",{class:"w-5"},null,-1))]),s.value?(w(),b("div",Q,[t("div",X,[e[6]||(e[6]=t("span",{class:"text-muted-foreground"},"订单编号",-1)),t("span",Y,l(s.value.orderNo),1)]),t("div",Z,[e[7]||(e[7]=t("span",{class:"text-muted-foreground"},"充值号码",-1)),t("span",ee,l(s.value.phoneNumber),1)]),t("div",te,[e[8]||(e[8]=t("span",{class:"text-muted-foreground"},"充值面值",-1)),t("span",se,l(s.value.faceValue)+"元",1)]),t("div",oe,[e[9]||(e[9]=t("span",{class:"text-muted-foreground"},"应付金额",-1)),t("span",ae,"¥"+l(s.value.payAmount.toFixed(2)),1)])])):R("",!0),t("div",ne,[e[11]||(e[11]=t("div",{class:"text-base font-bold text-foreground mb-3"},"支付方式",-1)),a(C,{value:i.value,"onUpdate:value":e[1]||(e[1]=n=>i.value=n),class:"w-full"},{default:f(()=>[a(B,{value:1,class:"w-full !flex items-center py-2"},{default:f(()=>[t("div",le,[a(v(K),{class:"text-2xl text-primary mr-2"}),e[10]||(e[10]=t("span",null,"余额支付",-1)),t("span",re,"（余额: ¥"+l(_.value.toFixed(2))+"）",1)])]),_:1})]),_:1},8,["value"])]),t("div",ue,[t("div",de,[e[12]||(e[12]=t("span",{class:"text-foreground"},"需支付：",-1)),t("span",ie,"¥"+l(((y=(g=s.value)==null?void 0:g.payAmount)==null?void 0:y.toFixed(2))||"0.00"),1)]),a(O,{type:"primary",size:"large",class:"w-28 h-11",loading:p.value,onClick:N},{default:f(()=>[...e[13]||(e[13]=[j(" 确认支付 ",-1)])]),_:1},8,["loading"])]),a(V,{open:c.value,"onUpdate:open":e[3]||(e[3]=n=>c.value=n),title:"输入支付密码","confirm-loading":p.value,onOk:P},{default:f(()=>[a(I,{value:r.value,"onUpdate:value":e[2]||(e[2]=n=>r.value=n),placeholder:"请输入6位支付密码",maxlength:6,size:"large",class:"mt-4"},null,8,["value"])]),_:1},8,["open","confirm-loading"])])}}});export{xe as default};
