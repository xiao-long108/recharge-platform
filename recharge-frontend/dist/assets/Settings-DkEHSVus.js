import{d as b,u as C,D as U,r as P,a as h,c as B,b as t,e as a,i as r,h as S,L as D,R as v,t as F,w as l,M as I,o as _,F as N,p as O,z as R,j as V,_ as L,k as u}from"./index-4bcZGDoL.js";import{c as M,e as $}from"./user-CwnAAeo_.js";import"./request-C-LQhwRX.js";const j={class:"page-container"},z={class:"flex items-center bg-primary text-white p-4"},E={class:"menu-card m-3"},q={class:"text-sm text-foreground"},K=b({__name:"Settings",setup(A){const c=S(),i=C(),n=U(()=>{var w;return((w=i.userInfo)==null?void 0:w.hasPayPassword)||!1}),d=P(!1),m=P(!1),e=h({oldPassword:"",newPassword:"",confirmPassword:""});function g(){e.oldPassword="",e.newPassword="",e.confirmPassword="",d.value=!0}async function x(){if(!e.newPassword||e.newPassword.length!==6){u.error("请输入6位支付密码");return}if(e.newPassword!==e.confirmPassword){u.error("两次输入的密码不一致");return}if(n.value&&!e.oldPassword){u.error("请输入旧支付密码");return}m.value=!0;try{n.value?await M(e.oldPassword,e.newPassword):await $(e.newPassword),u.success("设置成功"),d.value=!1,i.userInfo&&(i.userInfo.hasPayPassword=!0)}catch{}finally{m.value=!1}}return(w,s)=>{const f=V,p=L,y=N,k=I;return _(),B("div",j,[t("div",z,[a(r(D),{class:"text-xl cursor-pointer",onClick:s[0]||(s[0]=o=>r(c).back())}),s[6]||(s[6]=t("span",{class:"flex-1 text-center text-lg font-bold"},"账号设置",-1)),s[7]||(s[7]=t("span",{class:"w-5"},null,-1))]),t("div",E,[t("div",{class:"menu-item",onClick:s[1]||(s[1]=o=>r(c).push("/profile/change-password"))},[s[8]||(s[8]=t("span",{class:"text-sm text-foreground"},"修改登录密码",-1)),a(r(v),{class:"text-sm text-muted-foreground"})]),t("div",{class:"menu-item",onClick:g},[t("span",q,F(n.value?"修改支付密码":"设置支付密码"),1),a(r(v),{class:"text-sm text-muted-foreground"})])]),a(k,{open:d.value,"onUpdate:open":s[5]||(s[5]=o=>d.value=o),title:n.value?"修改支付密码":"设置支付密码","confirm-loading":m.value,onOk:x},{default:l(()=>[a(y,{layout:"vertical",class:"mt-4"},{default:l(()=>[n.value?(_(),O(p,{key:0,label:"旧支付密码"},{default:l(()=>[a(f,{value:e.oldPassword,"onUpdate:value":s[2]||(s[2]=o=>e.oldPassword=o),maxlength:6},null,8,["value"])]),_:1})):R("",!0),a(p,{label:"新支付密码"},{default:l(()=>[a(f,{value:e.newPassword,"onUpdate:value":s[3]||(s[3]=o=>e.newPassword=o),maxlength:6},null,8,["value"])]),_:1}),a(p,{label:"确认密码"},{default:l(()=>[a(f,{value:e.confirmPassword,"onUpdate:value":s[4]||(s[4]=o=>e.confirmPassword=o),maxlength:6},null,8,["value"])]),_:1})]),_:1})]),_:1},8,["open","title","confirm-loading"])])}}});export{K as default};
