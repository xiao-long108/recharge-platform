import{d as C,u as P,r as m,D as N,x as V,v as B,c as i,b as t,z as F,e as d,i as p,h as S,L as z,w as b,I as M,m as q,n as L,t as n,B as O,o as u,s as $,f as D,k as R}from"./index-4bcZGDoL.js";import{g as U}from"./product-BlSYDnSq.js";import{c as E}from"./order-BCzdytcL.js";import{M as T}from"./MobileOutlined-C3fNM2V5.js";import"./request-C-LQhwRX.js";const j={class:"page-container !pb-24"},A={class:"flex items-center bg-primary text-white p-4"},G={class:"card-box m-3 relative"},H={class:"card-box m-3"},J={class:"grid-4"},K=["onClick"],Q={class:"text-base font-bold text-foreground"},W={class:"text-sm text-destructive mt-1"},X={class:"text-xs text-muted-foreground mt-1"},Y={key:0,class:"card-box m-3"},Z={class:"list-item"},ee={class:"text-foreground"},te={class:"list-item"},se={class:"text-success"},oe={class:"list-item border-t border-border mt-2 pt-3 font-bold"},ae={class:"text-destructive text-lg"},re={class:"fixed bottom-0 left-0 right-0 bg-card p-4 shadow-[0_-2px_10px_rgba(0,0,0,0.05)]"},pe=C({__name:"Index",setup(ne){const v=S(),f=B(),x=P(),r=m(""),l=m([]),s=m(null),g=N(()=>r.value.length===11&&s.value);V(async()=>{if(await h(),f.query.productId){const o=Number(f.query.productId),e=l.value.find(c=>c.id===o);e&&(s.value=e)}});async function h(){try{l.value=await U(),l.value.length>0&&!s.value&&(s.value=l.value[0])}catch{}}function y(){var o;(o=x.userInfo)!=null&&o.phone&&(r.value=x.userInfo.phone)}function k(o){s.value=o}async function I(){if(s.value){if(!/^1[3-9]\d{9}$/.test(r.value)){R.error("请输入正确的手机号");return}try{const o=await E({productId:s.value.id,phoneNumber:r.value});v.push({path:"/recharge/confirm",query:{orderId:o.id}})}catch{}}}return(o,e)=>{const c=M,w=O;return u(),i("div",j,[t("div",A,[d(p(z),{class:"text-xl cursor-pointer",onClick:e[0]||(e[0]=a=>p(v).back())}),e[2]||(e[2]=t("span",{class:"flex-1 text-center text-lg font-bold"},"话费充值",-1)),e[3]||(e[3]=t("span",{class:"w-5"},null,-1))]),t("div",G,[e[4]||(e[4]=t("div",{class:"text-sm text-foreground mb-3"},"充值号码",-1)),d(c,{value:r.value,"onUpdate:value":e[1]||(e[1]=a=>r.value=a),placeholder:"请输入充值手机号",maxlength:11,size:"large"},{prefix:b(()=>[d(p(T),{class:"text-muted-foreground"})]),_:1},8,["value"]),t("span",{class:"absolute right-7 top-12 text-primary text-sm cursor-pointer",onClick:y}," 充本机 ")]),t("div",H,[e[5]||(e[5]=t("div",{class:"text-sm text-foreground mb-3"},"选择面值",-1)),t("div",J,[(u(!0),i(q,null,L(l.value,a=>{var _;return u(),i("div",{key:a.id,class:$(["product-item",{selected:((_=s.value)==null?void 0:_.id)===a.id}]),onClick:le=>k(a)},[t("div",Q,n(a.faceValue)+"元",1),t("div",W,"¥"+n(a.salePrice.toFixed(2)),1),t("div",X,n((a.discount*10).toFixed(1))+"折",1)],10,K)}),128))])]),s.value?(u(),i("div",Y,[t("div",Z,[e[6]||(e[6]=t("span",{class:"text-muted-foreground"},"充值面值",-1)),t("span",ee,n(s.value.faceValue)+"元",1)]),t("div",te,[e[7]||(e[7]=t("span",{class:"text-muted-foreground"},"优惠金额",-1)),t("span",se,"-¥"+n((s.value.faceValue-s.value.salePrice).toFixed(2)),1)]),t("div",oe,[e[8]||(e[8]=t("span",{class:"text-foreground"},"实付金额",-1)),t("span",ae,"¥"+n(s.value.salePrice.toFixed(2)),1)])])):F("",!0),t("div",re,[d(w,{type:"primary",size:"large",class:"w-full h-12 text-base rounded-lg",disabled:!g.value,onClick:I},{default:b(()=>[...e[9]||(e[9]=[D(" 立即充值 ",-1)])]),_:1},8,["disabled"])])])}}});export{pe as default};
