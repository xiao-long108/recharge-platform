import{r as w}from"./request-npLowYHc.js";import{e,k as Z,d as K,r as y,a as h,E as tt,c as et,b as s,h as o,y as u,w as l,I as at,R as lt,B as st,W as nt,a7 as it,O as U,f as g,Q as I,T as ot,V as dt,a9 as rt,a8 as ut,aa as ct,a0 as pt,ab as _t,ac as vt,ad as ft,F as mt,_ as gt,a5 as bt,a3 as yt,a4 as Pt,i as C,o as Ot,j as wt}from"./index-Djgp8zeB.js";var Ct={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M928 160H96c-17.7 0-32 14.3-32 32v640c0 17.7 14.3 32 32 32h832c17.7 0 32-14.3 32-32V192c0-17.7-14.3-32-32-32zm-792 72h752v120H136V232zm752 560H136V440h752v352zm-237-64h165c4.4 0 8-3.6 8-8v-72c0-4.4-3.6-8-8-8H651c-4.4 0-8 3.6-8 8v72c0 4.4 3.6 8 8 8z"}}]},name:"credit-card",theme:"outlined"};function R(_){for(var d=1;d<arguments.length;d++){var c=arguments[d]!=null?Object(arguments[d]):{},v=Object.keys(c);typeof Object.getOwnPropertySymbols=="function"&&(v=v.concat(Object.getOwnPropertySymbols(c).filter(function(r){return Object.getOwnPropertyDescriptor(c,r).enumerable}))),v.forEach(function(r){xt(_,r,c[r])})}return _}function xt(_,d,c){return d in _?Object.defineProperty(_,d,{value:c,enumerable:!0,configurable:!0,writable:!0}):_[d]=c,_}var N=function(d,c){var v=R({},d,c.attrs);return e(Z,R({},v,{icon:Ct}),null)};N.displayName="CreditCardOutlined";N.inheritAttrs=!1;const kt={class:"products-page"},zt={class:"stats-cards"},St={class:"stat-card"},$t={class:"stat-value blue"},ht={class:"stat-card"},Ut={class:"stat-value green"},Nt={class:"stat-card"},Vt={class:"stat-value orange"},jt={class:"stat-card"},qt={class:"stat-value green"},Bt={class:"filter-bar"},Et={class:"filter-left"},It={class:"filter-right"},Rt={class:"table-container"},Dt={class:"product-info"},Ft={class:"product-detail"},Ht={class:"title"},Tt={class:"product-id"},Mt={class:"price"},At={class:"real-price"},Qt={class:"pagination-container"},Lt={class:"total-text"},Wt=K({__name:"Products",setup(_){const d=y(!1),c=y([]),v=y(0),r=h({totalProducts:0,enabledProducts:0,disabledProducts:0,todayOrders:0}),p=h({pageNum:1,pageSize:10,title:"",disable:null}),x=async()=>{try{const n=await w.get("/api/admin/stats/products");n.data.code===200&&Object.assign(r,n.data.data)}catch{r.totalProducts=12,r.enabledProducts=10,r.disabledProducts=2,r.todayOrders=568}},f=async()=>{d.value=!0;try{const n=await w.get("/api/admin/products",{params:p});n.data.code===200&&(c.value=n.data.data.records,v.value=n.data.data.total)}catch(n){console.error(n)}finally{d.value=!1}},D=()=>{p.title="",p.disable=null,p.pageNum=1,f()},P=y(!1),O=y(!1),V=y(),z=y(null),i=h({title:"",price:50,realPrice:50,disable:1}),F={title:[{required:!0,message:"请输入产品名称",trigger:"blur"}],price:[{required:!0,message:"请输入面值",trigger:"blur"}],realPrice:[{required:!0,message:"请输入实际到账",trigger:"blur"}]},H=()=>{O.value=!1,z.value=null,i.title="",i.price=50,i.realPrice=50,i.disable=1,P.value=!0},T=n=>{O.value=!0,z.value=n.id,i.title=n.title,i.price=n.price,i.realPrice=n.realPrice,i.disable=n.disable,P.value=!0},M=async()=>{await V.value.validate();try{O.value?await w.put(`/api/admin/products/${z.value}`,i):await w.post("/api/admin/products",i),C.success(O.value?"修改成功":"添加成功"),P.value=!1,f(),x()}catch{C.error("操作失败")}},A=async n=>{const t=n.disable===1?"禁用":"启用";U.confirm({title:"提示",content:`确定要${t}该产品吗？`,onOk:async()=>{try{await w.put(`/api/admin/products/${n.id}/toggle`),C.success(`${t}成功`),f(),x()}catch{C.error(`${t}失败`)}}})},Q=async n=>{U.confirm({title:"提示",content:"确定要删除该产品吗？删除后无法恢复",onOk:async()=>{try{await w.delete(`/api/admin/products/${n.id}`),C.success("删除成功"),f(),x()}catch{C.error("删除失败")}}})};return tt(()=>{x(),f()}),(n,t)=>{const S=at,$=ot,L=lt,m=st,b=ut,j=pt,W=nt,G=it,k=gt,q=bt,B=Pt,J=yt,X=mt,Y=U;return Ot(),et("div",kt,[s("div",zt,[s("div",St,[t[11]||(t[11]=s("div",{class:"stat-label"},"产品总数",-1)),s("div",$t,[o(u(r.totalProducts)+" ",1),t[10]||(t[10]=s("span",{class:"unit"},"个",-1))])]),s("div",ht,[t[13]||(t[13]=s("div",{class:"stat-label"},"已启用",-1)),s("div",Ut,[o(u(r.enabledProducts)+" ",1),t[12]||(t[12]=s("span",{class:"unit"},"个",-1))])]),s("div",Nt,[t[15]||(t[15]=s("div",{class:"stat-label"},"已禁用",-1)),s("div",Vt,[o(u(r.disabledProducts)+" ",1),t[14]||(t[14]=s("span",{class:"unit"},"个",-1))])]),s("div",jt,[t[17]||(t[17]=s("div",{class:"stat-label"},"今日订单",-1)),s("div",qt,[o(u(r.todayOrders)+" ",1),t[16]||(t[16]=s("span",{class:"unit"},"笔",-1))])])]),s("div",Bt,[s("div",Et,[e(S,{value:p.title,"onUpdate:value":t[0]||(t[0]=a=>p.title=a),placeholder:"产品名称","allow-clear":"",style:{width:"180px"}},{prefix:l(()=>[e(g(I))]),_:1},8,["value"]),e(L,{value:p.disable,"onUpdate:value":t[1]||(t[1]=a=>p.disable=a),placeholder:"产品状态","allow-clear":"",style:{width:"140px"}},{default:l(()=>[e($,{value:null},{default:l(()=>[...t[18]||(t[18]=[o("全部",-1)])]),_:1}),e($,{value:1},{default:l(()=>[...t[19]||(t[19]=[o("已启用",-1)])]),_:1}),e($,{value:0},{default:l(()=>[...t[20]||(t[20]=[o("已禁用",-1)])]),_:1})]),_:1},8,["value"])]),s("div",It,[e(m,{type:"primary",onClick:f},{icon:l(()=>[e(g(I))]),default:l(()=>[t[21]||(t[21]=o(" 查询 ",-1))]),_:1}),e(m,{onClick:D},{icon:l(()=>[e(g(dt))]),default:l(()=>[t[22]||(t[22]=o(" 重置 ",-1))]),_:1}),e(m,{type:"primary",onClick:H},{icon:l(()=>[e(g(rt))]),default:l(()=>[t[23]||(t[23]=o(" 添加产品 ",-1))]),_:1})])]),s("div",Rt,[e(W,{"data-source":c.value,loading:d.value,pagination:!1,scroll:{x:1e3}},{default:l(()=>[e(b,{title:"产品信息","data-index":"title",width:220},{default:l(({record:a})=>[s("div",Dt,[s("div",{class:ct(["product-icon",{disabled:a.disable!==1}])},[e(g(N))],2),s("div",Ft,[s("div",Ht,u(a.title),1),s("div",Tt,"ID: "+u(a.id),1)])])]),_:1}),e(b,{title:"面值","data-index":"price",width:120,align:"center"},{default:l(({record:a})=>[s("span",Mt,"R$ "+u(a.price),1)]),_:1}),e(b,{title:"实际到账","data-index":"realPrice",width:120,align:"center"},{default:l(({record:a})=>[s("span",At,"R$ "+u(a.realPrice),1)]),_:1}),e(b,{title:"折扣率",width:100,align:"center"},{default:l(({record:a})=>[e(j,{color:"default"},{default:l(()=>[o(u((a.realPrice/a.price*100).toFixed(1))+"% ",1)]),_:2},1024)]),_:1}),e(b,{title:"状态","data-index":"disable",width:100,align:"center"},{default:l(({record:a})=>[e(j,{color:a.disable===1?"success":"error"},{default:l(()=>[o(u(a.disable===1?"启用":"禁用"),1)]),_:2},1032,["color"])]),_:1}),e(b,{title:"更新时间","data-index":"addtime",width:160,align:"center"}),e(b,{title:"操作",width:180,align:"center",fixed:"right"},{default:l(({record:a})=>[e(m,{type:"link",size:"small",onClick:E=>T(a)},{default:l(()=>[e(g(_t)),t[24]||(t[24]=o(" 编辑 ",-1))]),_:1},8,["onClick"]),e(m,{type:"link",size:"small",onClick:E=>A(a)},{default:l(()=>[e(g(vt)),o(" "+u(a.disable===1?"禁用":"启用"),1)]),_:2},1032,["onClick"]),e(m,{type:"link",danger:"",size:"small",onClick:E=>Q(a)},{default:l(()=>[e(g(ft))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data-source","loading"])]),s("div",Qt,[s("span",Lt,"共 "+u(v.value)+" 条记录",1),e(G,{current:p.pageNum,"onUpdate:current":t[2]||(t[2]=a=>p.pageNum=a),"page-size":p.pageSize,"onUpdate:pageSize":t[3]||(t[3]=a=>p.pageSize=a),total:v.value,"show-size-changer":!0,"page-size-options":["10","20","50","100"],"show-quick-jumper":"",onChange:f,onShowSizeChange:f},null,8,["current","page-size","total"])]),e(Y,{open:P.value,"onUpdate:open":t[9]||(t[9]=a=>P.value=a),title:O.value?"编辑产品":"添加产品",width:"500px"},{footer:l(()=>[e(m,{onClick:t[8]||(t[8]=a=>P.value=!1)},{default:l(()=>[...t[29]||(t[29]=[o("取消",-1)])]),_:1}),e(m,{type:"primary",onClick:M},{default:l(()=>[o(u(O.value?"保存":"添加"),1)]),_:1})]),default:l(()=>[e(X,{model:i,rules:F,ref_key:"formRef",ref:V,"label-col":{span:6},"wrapper-col":{span:18}},{default:l(()=>[e(k,{label:"产品名称",name:"title"},{default:l(()=>[e(S,{value:i.title,"onUpdate:value":t[4]||(t[4]=a=>i.title=a),placeholder:"如：50元话费充值"},null,8,["value"])]),_:1}),e(k,{label:"面值",name:"price"},{default:l(()=>[e(q,{value:i.price,"onUpdate:value":t[5]||(t[5]=a=>i.price=a),min:1,step:10,style:{width:"200px"}},null,8,["value"]),t[25]||(t[25]=s("span",{class:"form-hint"},"用户支付金额",-1))]),_:1}),e(k,{label:"实际到账",name:"realPrice"},{default:l(()=>[e(q,{value:i.realPrice,"onUpdate:value":t[6]||(t[6]=a=>i.realPrice=a),min:1,step:10,style:{width:"200px"}},null,8,["value"]),t[26]||(t[26]=s("span",{class:"form-hint"},"用户实际获得金额",-1))]),_:1}),e(k,{label:"状态"},{default:l(()=>[e(J,{value:i.disable,"onUpdate:value":t[7]||(t[7]=a=>i.disable=a),"button-style":"solid"},{default:l(()=>[e(B,{value:1},{default:l(()=>[...t[27]||(t[27]=[o("启用",-1)])]),_:1}),e(B,{value:0},{default:l(()=>[...t[28]||(t[28]=[o("禁用",-1)])]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}}),Xt=wt(Wt,[["__scopeId","data-v-e9ebc6d7"]]);export{Xt as default};
