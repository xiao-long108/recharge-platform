import{r as v}from"./request-npLowYHc.js";import{d as tt,r as _,a as S,E as et,c as at,b as n,e,h as o,y as r,w as a,I as st,R as lt,B as nt,W as ot,a7 as it,O as E,f,Q as j,T as ut,V as dt,a9 as pt,a8 as rt,p as ct,X as _t,a0 as ft,ab as mt,ah as vt,ad as gt,F as yt,_ as bt,a3 as kt,a4 as xt,a6 as Ct,P as Tt,ai as wt,i as g,o as I,j as zt}from"./index-Djgp8zeB.js";const Nt={class:"notices-page"},Ot={class:"stats-cards"},St={class:"stat-card"},Ut={class:"stat-value blue"},$t={class:"stat-card"},Vt={class:"stat-value green"},Bt={class:"stat-card"},qt={class:"stat-value orange"},Et={class:"stat-card"},jt={class:"stat-value green"},It={class:"filter-bar"},Rt={class:"filter-left"},Dt={class:"filter-right"},Ft={class:"table-container"},At={class:"notice-title"},Mt={class:"pagination-container"},Pt={class:"total-text"},Qt={class:"flex justify-end gap-2"},Lt=tt({__name:"Notices",setup(Wt){const x=_(!1),U=_([]),C=_(0),m=_(!1),k=_(!1),$=_(),T=_(null),d=S({total:0,published:0,draft:0,monthCount:0}),u=S({pageNum:1,pageSize:10,title:"",status:null}),i=S({title:"",type:1,content:"",isTop:!1}),R={title:[{required:!0,message:"请输入公告标题",trigger:"blur"}],content:[{required:!0,message:"请输入公告内容",trigger:"blur"}]},D=l=>({1:"系统公告",2:"活动通知",3:"更新日志"})[l]||"其他",F=l=>({1:"blue",2:"orange",3:"green"})[l]||"default",w=async()=>{try{const l=await v.get("/api/admin/notices/stats");l.data.code===200&&Object.assign(d,l.data.data)}catch{d.total=15,d.published=12,d.draft=3,d.monthCount=5}},c=async()=>{x.value=!0;try{const l=await v.get("/api/admin/notices",{params:u});l.data.code===200&&(U.value=l.data.data.records,C.value=l.data.data.total)}catch(l){console.error(l)}finally{x.value=!1}},A=()=>{u.title="",u.status=null,u.pageNum=1,c()},M=()=>{k.value=!1,T.value=null,i.title="",i.type=1,i.content="",i.isTop=!1,m.value=!0},P=l=>{k.value=!0,T.value=l.id,i.title=l.title,i.type=l.type,i.content=l.content,i.isTop=l.isTop===1,m.value=!0},V=async l=>{await $.value.validate();try{const t={...i,status:l,isTop:i.isTop?1:0};k.value?await v.put(`/api/admin/notices/${T.value}`,t):await v.post("/api/admin/notices",t),g.success(l===1?"发布成功":"保存成功"),m.value=!1,c(),w()}catch{g.error("操作失败")}},Q=async l=>{try{await v.put(`/api/admin/notices/${l.id}/top`),g.success(l.isTop===1?"已取消置顶":"已置顶"),c()}catch{g.error("操作失败")}},L=l=>{E.confirm({title:"提示",content:"确定要删除该公告吗？",onOk:async()=>{try{await v.delete(`/api/admin/notices/${l.id}`),g.success("删除成功"),c(),w()}catch{g.error("删除失败")}}})};return et(()=>{w(),c()}),(l,t)=>{const B=st,z=ut,W=lt,p=nt,N=ft,y=rt,X=ot,G=it,b=bt,O=xt,H=kt,J=Ct,K=wt,Y=Tt,Z=yt,h=E;return I(),at("div",Nt,[n("div",Ot,[n("div",St,[t[13]||(t[13]=n("div",{class:"stat-label"},"公告总数",-1)),n("div",Ut,[o(r(d.total)+" ",1),t[12]||(t[12]=n("span",{class:"unit"},"条",-1))])]),n("div",$t,[t[15]||(t[15]=n("div",{class:"stat-label"},"已发布",-1)),n("div",Vt,[o(r(d.published)+" ",1),t[14]||(t[14]=n("span",{class:"unit"},"条",-1))])]),n("div",Bt,[t[17]||(t[17]=n("div",{class:"stat-label"},"草稿",-1)),n("div",qt,[o(r(d.draft)+" ",1),t[16]||(t[16]=n("span",{class:"unit"},"条",-1))])]),n("div",Et,[t[19]||(t[19]=n("div",{class:"stat-label"},"本月新增",-1)),n("div",jt,[o(r(d.monthCount)+" ",1),t[18]||(t[18]=n("span",{class:"unit"},"条",-1))])])]),n("div",It,[n("div",Rt,[e(B,{value:u.title,"onUpdate:value":t[0]||(t[0]=s=>u.title=s),placeholder:"公告标题","allow-clear":"",style:{width:"200px"}},{prefix:a(()=>[e(f(j))]),_:1},8,["value"]),e(W,{value:u.status,"onUpdate:value":t[1]||(t[1]=s=>u.status=s),placeholder:"状态","allow-clear":"",style:{width:"120px"}},{default:a(()=>[e(z,{value:null},{default:a(()=>[...t[20]||(t[20]=[o("全部",-1)])]),_:1}),e(z,{value:1},{default:a(()=>[...t[21]||(t[21]=[o("已发布",-1)])]),_:1}),e(z,{value:0},{default:a(()=>[...t[22]||(t[22]=[o("草稿",-1)])]),_:1})]),_:1},8,["value"])]),n("div",Dt,[e(p,{type:"primary",onClick:c},{icon:a(()=>[e(f(j))]),default:a(()=>[t[23]||(t[23]=o(" 查询 ",-1))]),_:1}),e(p,{onClick:A},{icon:a(()=>[e(f(dt))]),default:a(()=>[t[24]||(t[24]=o(" 重置 ",-1))]),_:1}),e(p,{type:"primary",onClick:M},{icon:a(()=>[e(f(pt))]),default:a(()=>[t[25]||(t[25]=o(" 发布公告 ",-1))]),_:1})])]),n("div",Ft,[e(X,{"data-source":U.value,loading:x.value,pagination:!1,scroll:{x:900}},{default:a(()=>[e(y,{title:"公告标题","data-index":"title",width:300},{default:a(({record:s})=>[n("div",At,[s.isTop===1?(I(),ct(N,{key:0,color:"red",size:"small"},{default:a(()=>[...t[26]||(t[26]=[o("置顶",-1)])]),_:1})):_t("",!0),o(" "+r(s.title),1)])]),_:1}),e(y,{title:"类型","data-index":"type",width:100,align:"center"},{default:a(({record:s})=>[e(N,{color:F(s.type)},{default:a(()=>[o(r(D(s.type)),1)]),_:2},1032,["color"])]),_:1}),e(y,{title:"状态","data-index":"status",width:100,align:"center"},{default:a(({record:s})=>[e(N,{color:s.status===1?"success":"default"},{default:a(()=>[o(r(s.status===1?"已发布":"草稿"),1)]),_:2},1032,["color"])]),_:1}),e(y,{title:"发布时间","data-index":"createTime",width:160,align:"center"}),e(y,{title:"操作",width:180,align:"center",fixed:"right"},{default:a(({record:s})=>[e(p,{type:"link",size:"small",onClick:q=>P(s)},{default:a(()=>[e(f(mt)),t[27]||(t[27]=o(" 编辑 ",-1))]),_:1},8,["onClick"]),e(p,{type:"link",size:"small",onClick:q=>Q(s)},{default:a(()=>[e(f(vt)),o(" "+r(s.isTop===1?"取消置顶":"置顶"),1)]),_:2},1032,["onClick"]),e(p,{type:"link",danger:"",size:"small",onClick:q=>L(s)},{default:a(()=>[e(f(gt))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data-source","loading"])]),n("div",Mt,[n("span",Pt,"共 "+r(C.value)+" 条记录",1),e(G,{current:u.pageNum,"onUpdate:current":t[2]||(t[2]=s=>u.pageNum=s),"page-size":u.pageSize,"onUpdate:pageSize":t[3]||(t[3]=s=>u.pageSize=s),total:C.value,"show-size-changer":!0,"show-quick-jumper":"",onChange:c},null,8,["current","page-size","total"])]),e(h,{open:m.value,"onUpdate:open":t[11]||(t[11]=s=>m.value=s),title:k.value?"编辑公告":"发布公告",width:"700px",footer:null},{default:a(()=>[e(Z,{model:i,rules:R,ref_key:"formRef",ref:$,layout:"vertical",class:"mt-4"},{default:a(()=>[e(b,{label:"公告标题",name:"title"},{default:a(()=>[e(B,{value:i.title,"onUpdate:value":t[4]||(t[4]=s=>i.title=s),placeholder:"请输入公告标题",maxlength:100,"show-count":""},null,8,["value"])]),_:1}),e(b,{label:"公告类型",name:"type"},{default:a(()=>[e(H,{value:i.type,"onUpdate:value":t[5]||(t[5]=s=>i.type=s)},{default:a(()=>[e(O,{value:1},{default:a(()=>[...t[28]||(t[28]=[o("系统公告",-1)])]),_:1}),e(O,{value:2},{default:a(()=>[...t[29]||(t[29]=[o("活动通知",-1)])]),_:1}),e(O,{value:3},{default:a(()=>[...t[30]||(t[30]=[o("更新日志",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),e(b,{label:"公告内容",name:"content"},{default:a(()=>[e(J,{value:i.content,"onUpdate:value":t[6]||(t[6]=s=>i.content=s),placeholder:"请输入公告内容",rows:6,maxlength:2e3,"show-count":""},null,8,["value"])]),_:1}),e(b,{label:"选项"},{default:a(()=>[e(Y,null,{default:a(()=>[e(K,{checked:i.isTop,"onUpdate:checked":t[7]||(t[7]=s=>i.isTop=s)},{default:a(()=>[...t[31]||(t[31]=[o("置顶显示",-1)])]),_:1},8,["checked"])]),_:1})]),_:1}),e(b,null,{default:a(()=>[n("div",Qt,[e(p,{onClick:t[8]||(t[8]=s=>m.value=!1)},{default:a(()=>[...t[32]||(t[32]=[o("取消",-1)])]),_:1}),e(p,{onClick:t[9]||(t[9]=s=>V(0))},{default:a(()=>[...t[33]||(t[33]=[o("保存为草稿",-1)])]),_:1}),e(p,{type:"primary",onClick:t[10]||(t[10]=s=>V(1))},{default:a(()=>[...t[34]||(t[34]=[o("立即发布",-1)])]),_:1})])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}}),Ht=zt(Lt,[["__scopeId","data-v-f5f5a5ef"]]);export{Ht as default};
