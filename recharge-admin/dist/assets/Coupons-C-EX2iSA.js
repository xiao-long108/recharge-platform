import{r as C}from"./request-npLowYHc.js";import{d as ot,r as c,a as z,E as it,c as ut,b as o,e,h as i,y as u,w as n,I as dt,R as pt,B as mt,W as rt,a7 as vt,O as B,f as g,Q as V,T as ft,V as _t,a9 as ct,a8 as gt,aa as yt,a0 as xt,p as w,X as A,ab as Ct,ad as Rt,F as bt,_ as kt,a3 as wt,aj as At,a5 as $t,U as Ut,i as R,o as k,j as Tt}from"./index-Djgp8zeB.js";import{G as Dt}from"./GiftOutlined-BmKMUPfx.js";const St={class:"coupons-page"},zt={class:"stats-cards"},Ot={class:"stat-card"},Lt={class:"stat-value blue"},Nt={class:"stat-card"},Yt={class:"stat-value green"},Mt={class:"stat-card"},qt={class:"stat-value orange"},Bt={class:"stat-card"},Vt={class:"stat-value green"},Et={class:"filter-bar"},Ft={class:"filter-left"},jt={class:"filter-right"},Ht={class:"table-container"},It={class:"coupon-info"},Gt={class:"coupon-detail"},Pt={class:"name"},Qt={class:"desc"},Wt={class:"text-green-500"},Xt={class:"text-xs"},Jt={class:"pagination-container"},Kt={class:"total-text"},Zt=ot({__name:"Coupons",setup(ht){const $=c(!1),O=c([]),U=c(0),y=c(!1),x=c(!1),L=c(),T=c(null),p=z({total:0,claimed:0,used:0,totalDiscount:0}),d=z({pageNum:1,pageSize:10,name:"",type:null,status:null}),l=z({name:"",type:1,minAmount:0,discountAmount:10,discountRate:90,totalCount:100,perLimit:1,timeRange:[]}),E={name:[{required:!0,message:"请输入优惠券名称",trigger:"blur"}],totalCount:[{required:!0,message:"请输入发放数量",trigger:"blur"}],timeRange:[{required:!0,message:"请选择有效期",trigger:"change"}]},F=s=>s?s.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00",j=s=>({1:"满减券",2:"折扣券",3:"立减券"})[s]||"未知",H=s=>({1:"blue",2:"purple",3:"orange"})[s]||"default",I=s=>({0:"已停止",1:"进行中",2:"已结束"})[s]||"未知",G=s=>({0:"default",1:"success",2:"error"})[s]||"default",P=s=>({1:"type-1",2:"type-2",3:"type-3"})[s]||"",Q=s=>s.type===1?`满R$${s.minAmount}减R$${s.discountAmount}`:s.type===2?`满R$${s.minAmount}打${s.discountRate/10}折`:`立减R$${s.discountAmount}`,D=async()=>{try{const s=await C.get("/api/admin/coupons/stats");s.data.code===200&&Object.assign(p,s.data.data)}catch{p.total=5e3,p.claimed=3200,p.used=1800,p.totalDiscount=56800}},f=async()=>{$.value=!0;try{const s=await C.get("/api/admin/coupons",{params:d});s.data.code===200&&(O.value=s.data.data.records,U.value=s.data.data.total)}catch(s){console.error(s)}finally{$.value=!1}},W=()=>{d.name="",d.type=null,d.status=null,d.pageNum=1,f()},X=()=>{x.value=!1,T.value=null,l.name="",l.type=1,l.minAmount=0,l.discountAmount=10,l.discountRate=90,l.totalCount=100,l.perLimit=1,l.timeRange=[],y.value=!0},J=s=>{x.value=!0,T.value=s.id,l.name=s.name,l.type=s.type,l.minAmount=s.minAmount,l.discountAmount=s.discountAmount,l.discountRate=s.discountRate,l.totalCount=s.totalCount,l.perLimit=s.perLimit,l.timeRange=[s.startTime,s.endTime],y.value=!0},K=async()=>{await L.value.validate();try{const s={...l,startTime:l.timeRange[0],endTime:l.timeRange[1]};x.value?await C.put(`/api/admin/coupons/${T.value}`,s):await C.post("/api/admin/coupons",s),R.success(x.value?"修改成功":"创建成功"),y.value=!1,f(),D()}catch{R.error("操作失败")}},Z=async s=>{try{await C.put(`/api/admin/coupons/${s.id}/toggle`),R.success("操作成功"),f()}catch{R.error("操作失败")}},h=s=>{B.confirm({title:"提示",content:"确定要删除该优惠券吗？已领取的优惠券将失效",onOk:async()=>{try{await C.delete(`/api/admin/coupons/${s.id}`),R.success("删除成功"),f(),D()}catch{R.error("删除失败")}}})};return it(()=>{D(),f()}),(s,t)=>{const N=dt,m=ft,Y=pt,r=mt,_=gt,M=xt,tt=rt,et=vt,v=kt,S=At,at=wt,b=$t,nt=Ut,st=bt,lt=B;return k(),ut("div",St,[o("div",zt,[o("div",Ot,[t[16]||(t[16]=o("div",{class:"stat-label"},"优惠券总数",-1)),o("div",Lt,[i(u(p.total)+" ",1),t[15]||(t[15]=o("span",{class:"unit"},"张",-1))])]),o("div",Nt,[t[18]||(t[18]=o("div",{class:"stat-label"},"已领取",-1)),o("div",Yt,[i(u(p.claimed)+" ",1),t[17]||(t[17]=o("span",{class:"unit"},"张",-1))])]),o("div",Mt,[t[20]||(t[20]=o("div",{class:"stat-label"},"已使用",-1)),o("div",qt,[i(u(p.used)+" ",1),t[19]||(t[19]=o("span",{class:"unit"},"张",-1))])]),o("div",Bt,[t[21]||(t[21]=o("div",{class:"stat-label"},"优惠总额",-1)),o("div",Vt,"R$ "+u(F(p.totalDiscount)),1)])]),o("div",Et,[o("div",Ft,[e(N,{value:d.name,"onUpdate:value":t[0]||(t[0]=a=>d.name=a),placeholder:"优惠券名称","allow-clear":"",style:{width:"180px"}},{prefix:n(()=>[e(g(V))]),_:1},8,["value"]),e(Y,{value:d.type,"onUpdate:value":t[1]||(t[1]=a=>d.type=a),placeholder:"类型","allow-clear":"",style:{width:"120px"}},{default:n(()=>[e(m,{value:null},{default:n(()=>[...t[22]||(t[22]=[i("全部",-1)])]),_:1}),e(m,{value:1},{default:n(()=>[...t[23]||(t[23]=[i("满减券",-1)])]),_:1}),e(m,{value:2},{default:n(()=>[...t[24]||(t[24]=[i("折扣券",-1)])]),_:1}),e(m,{value:3},{default:n(()=>[...t[25]||(t[25]=[i("立减券",-1)])]),_:1})]),_:1},8,["value"]),e(Y,{value:d.status,"onUpdate:value":t[2]||(t[2]=a=>d.status=a),placeholder:"状态","allow-clear":"",style:{width:"120px"}},{default:n(()=>[e(m,{value:null},{default:n(()=>[...t[26]||(t[26]=[i("全部",-1)])]),_:1}),e(m,{value:1},{default:n(()=>[...t[27]||(t[27]=[i("进行中",-1)])]),_:1}),e(m,{value:0},{default:n(()=>[...t[28]||(t[28]=[i("已停止",-1)])]),_:1}),e(m,{value:2},{default:n(()=>[...t[29]||(t[29]=[i("已结束",-1)])]),_:1})]),_:1},8,["value"])]),o("div",jt,[e(r,{type:"primary",onClick:f},{icon:n(()=>[e(g(V))]),default:n(()=>[t[30]||(t[30]=i(" 查询 ",-1))]),_:1}),e(r,{onClick:W},{icon:n(()=>[e(g(_t))]),default:n(()=>[t[31]||(t[31]=i(" 重置 ",-1))]),_:1}),e(r,{type:"primary",onClick:X},{icon:n(()=>[e(g(ct))]),default:n(()=>[t[32]||(t[32]=i(" 创建优惠券 ",-1))]),_:1})])]),o("div",Ht,[e(tt,{"data-source":O.value,loading:$.value,pagination:!1,scroll:{x:1100}},{default:n(()=>[e(_,{title:"优惠券信息",width:260},{default:n(({record:a})=>[o("div",It,[o("div",{class:yt(["coupon-icon",P(a.type)])},[e(g(Dt))],2),o("div",Gt,[o("div",Pt,u(a.name),1),o("div",Qt,u(Q(a)),1)])])]),_:1}),e(_,{title:"类型","data-index":"type",width:100,align:"center"},{default:n(({record:a})=>[e(M,{color:H(a.type)},{default:n(()=>[i(u(j(a.type)),1)]),_:2},1032,["color"])]),_:1}),e(_,{title:"发放/领取",width:120,align:"center"},{default:n(({record:a})=>[o("span",null,u(a.claimedCount||0)+" / "+u(a.totalCount),1)]),_:1}),e(_,{title:"已使用",width:80,align:"center"},{default:n(({record:a})=>[o("span",Wt,u(a.usedCount||0),1)]),_:1}),e(_,{title:"有效期",width:200,align:"center"},{default:n(({record:a})=>[o("div",Xt,[o("div",null,u(a.startTime),1),o("div",null,"至 "+u(a.endTime),1)])]),_:1}),e(_,{title:"状态","data-index":"status",width:90,align:"center"},{default:n(({record:a})=>[e(M,{color:G(a.status)},{default:n(()=>[i(u(I(a.status)),1)]),_:2},1032,["color"])]),_:1}),e(_,{title:"操作",width:180,align:"center",fixed:"right"},{default:n(({record:a})=>[e(r,{type:"link",size:"small",onClick:q=>J(a)},{default:n(()=>[e(g(Ct)),t[33]||(t[33]=i(" 编辑 ",-1))]),_:1},8,["onClick"]),a.status!==2?(k(),w(r,{key:0,type:"link",size:"small",onClick:q=>Z(a)},{default:n(()=>[i(u(a.status===1?"停止":"启用"),1)]),_:2},1032,["onClick"])):A("",!0),e(r,{type:"link",danger:"",size:"small",onClick:q=>h(a)},{default:n(()=>[e(g(Rt))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data-source","loading"])]),o("div",Jt,[o("span",Kt,"共 "+u(U.value)+" 条记录",1),e(et,{current:d.pageNum,"onUpdate:current":t[3]||(t[3]=a=>d.pageNum=a),"page-size":d.pageSize,"onUpdate:pageSize":t[4]||(t[4]=a=>d.pageSize=a),total:U.value,"show-size-changer":!0,"show-quick-jumper":"",onChange:f},null,8,["current","page-size","total"])]),e(lt,{open:y.value,"onUpdate:open":t[14]||(t[14]=a=>y.value=a),title:x.value?"编辑优惠券":"创建优惠券",width:"600px"},{footer:n(()=>[e(r,{onClick:t[13]||(t[13]=a=>y.value=!1)},{default:n(()=>[...t[43]||(t[43]=[i("取消",-1)])]),_:1}),e(r,{type:"primary",onClick:K},{default:n(()=>[i(u(x.value?"保存":"创建"),1)]),_:1})]),default:n(()=>[e(st,{model:l,rules:E,ref_key:"formRef",ref:L,"label-col":{span:5},"wrapper-col":{span:18},class:"mt-4"},{default:n(()=>[e(v,{label:"优惠券名称",name:"name"},{default:n(()=>[e(N,{value:l.name,"onUpdate:value":t[5]||(t[5]=a=>l.name=a),placeholder:"如：新人专享券",maxlength:30},null,8,["value"])]),_:1}),e(v,{label:"优惠券类型",name:"type"},{default:n(()=>[e(at,{value:l.type,"onUpdate:value":t[6]||(t[6]=a=>l.type=a)},{default:n(()=>[e(S,{value:1},{default:n(()=>[...t[34]||(t[34]=[i("满减券",-1)])]),_:1}),e(S,{value:2},{default:n(()=>[...t[35]||(t[35]=[i("折扣券",-1)])]),_:1}),e(S,{value:3},{default:n(()=>[...t[36]||(t[36]=[i("立减券",-1)])]),_:1})]),_:1},8,["value"])]),_:1}),l.type!==3?(k(),w(v,{key:0,label:"使用门槛"},{default:n(()=>[e(b,{value:l.minAmount,"onUpdate:value":t[7]||(t[7]=a=>l.minAmount=a),min:0,precision:2,style:{width:"150px"}},null,8,["value"]),t[37]||(t[37]=o("span",{class:"ml-2 text-gray-500"},"满此金额可用",-1))]),_:1})):A("",!0),l.type===1||l.type===3?(k(),w(v,{key:1,label:"优惠金额",name:"discountAmount"},{default:n(()=>[e(b,{value:l.discountAmount,"onUpdate:value":t[8]||(t[8]=a=>l.discountAmount=a),min:1,precision:2,style:{width:"150px"}},{prefix:n(()=>[...t[38]||(t[38]=[i("R$",-1)])]),_:1},8,["value"])]),_:1})):A("",!0),l.type===2?(k(),w(v,{key:2,label:"折扣比例",name:"discountRate"},{default:n(()=>[e(b,{value:l.discountRate,"onUpdate:value":t[9]||(t[9]=a=>l.discountRate=a),min:1,max:99,precision:0,style:{width:"150px"}},{addonAfter:n(()=>[...t[39]||(t[39]=[i("%",-1)])]),_:1},8,["value"]),t[40]||(t[40]=o("span",{class:"ml-2 text-gray-500"},"用户支付原价的百分比",-1))]),_:1})):A("",!0),e(v,{label:"发放数量",name:"totalCount"},{default:n(()=>[e(b,{value:l.totalCount,"onUpdate:value":t[10]||(t[10]=a=>l.totalCount=a),min:1,max:1e5,style:{width:"150px"}},null,8,["value"]),t[41]||(t[41]=o("span",{class:"ml-2 text-gray-500"},"张",-1))]),_:1}),e(v,{label:"每人限领",name:"perLimit"},{default:n(()=>[e(b,{value:l.perLimit,"onUpdate:value":t[11]||(t[11]=a=>l.perLimit=a),min:1,max:10,style:{width:"150px"}},null,8,["value"]),t[42]||(t[42]=o("span",{class:"ml-2 text-gray-500"},"张",-1))]),_:1}),e(v,{label:"有效期",name:"timeRange"},{default:n(()=>[e(nt,{value:l.timeRange,"onUpdate:value":t[12]||(t[12]=a=>l.timeRange=a),"show-time":"",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm:ss",style:{width:"100%"}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open","title"])])}}}),ne=Tt(Zt,[["__scopeId","data-v-ff090fda"]]);export{ne as default};
