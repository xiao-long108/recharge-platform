import{r as A}from"./request-npLowYHc.js";import{d as tt,r as w,a as P,E as et,c as at,b as n,e,y as i,h as l,w as a,I as st,R as lt,U as nt,B as ot,W as it,a7 as ut,O,f as k,Q as X,T as dt,V as rt,a8 as pt,A as vt,a0 as ct,Y as ft,p as $,X as D,$ as _t,i as x,a1 as mt,o as S,j as gt}from"./index-Djgp8zeB.js";import{U as yt}from"./UploadOutlined-BLOLIyP5.js";const Ct={class:"orders-page"},bt={class:"stats-cards"},wt={class:"stat-card"},kt={class:"stat-value green"},xt={class:"stat-card"},St={class:"stat-value blue"},Nt={class:"stat-card"},At={class:"stat-value green"},$t={class:"stat-card"},Dt={class:"stat-value orange"},It={class:"filter-bar"},Rt={class:"filter-left"},Ut={class:"filter-right"},Ot={class:"table-container"},ht={class:"order-info"},Tt={class:"user-info"},zt={class:"user-detail"},Bt={class:"nickname"},Et={class:"user-id"},Vt={class:"pay-amount"},Mt={class:"pagination-container"},Pt={class:"total-text"},Xt="https://cube.elemecdn.com/3/7c/3ea6beec64369c2642b92c6726f1epng.png",Yt=tt({__name:"Orders",setup(jt){const I=w(!1),h=w([]),R=w(0),y=w([]),C=w(!1),u=w(null),p=P({todayAmount:0,todayCount:0,monthAmount:0,avgAmount:0}),d=P({pageNum:1,pageSize:10,orderNo:"",mobile:"",status:null,payChannel:""}),_=o=>o?o.toLocaleString("en-US",{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00",T=o=>({0:"待支付",1:"处理中",2:"成功","-1":"已取消","-2":"失败","-3":"已退款"})[o]||"未知",z=o=>({0:"default",1:"orange",2:"success","-1":"default","-2":"error","-3":"warning"})[o]||"default",Y=o=>({PIX:"blue",Boleto:"orange",CreditCard:"green",TED:"default"})[o]||"default",j=async()=>{try{const o=await A.get("/api/admin/stats");o.data.code===200&&Object.assign(p,o.data.data)}catch{p.todayAmount=125680050,p.todayCount=2568,p.monthAmount=3568e6,p.avgAmount=48950}},m=async()=>{var o;I.value=!0;try{const t={...d};((o=y.value)==null?void 0:o.length)===2&&(t.startDate=y.value[0],t.endDate=y.value[1]);const g=await A.get("/api/admin/orders",{params:t});g.data.code===200&&(h.value=g.data.data.records,R.value=g.data.data.total)}catch(t){console.error(t)}finally{I.value=!1}},q=()=>{d.orderNo="",d.mobile="",d.status=null,d.payChannel="",d.pageNum=1,y.value=[],m()},F=o=>{u.value=o,C.value=!0},B=async(o,t)=>{const g=t===2?"标记为成功":"标记为失败";O.confirm({title:"提示",content:`确定要${g}吗？`,onOk:async()=>{try{await A.put(`/api/admin/orders/${o.id}/status`,{status:t}),x.success("操作成功"),C.value=!1,m()}catch{x.error("操作失败")}}})},L=async o=>{O.confirm({title:"提示",content:"确定要退款吗？退款后将返还用户余额",onOk:async()=>{try{await A.post(`/api/admin/orders/${o.id}/refund`),x.success("退款成功"),C.value=!1,m()}catch{x.error("退款失败")}}})},Q=()=>{x.info("导出功能开发中")};return et(()=>{j(),m()}),(o,t)=>{const g=st,r=dt,E=lt,W=nt,c=ot,v=pt,G=vt,N=ct,H=it,J=ut,f=_t,K=mt,Z=O;return S(),at("div",Ct,[n("div",bt,[n("div",wt,[t[11]||(t[11]=n("div",{class:"stat-label"},"今日充值金额",-1)),n("div",kt,"R$ "+i(_(p.todayAmount)),1)]),n("div",xt,[t[13]||(t[13]=n("div",{class:"stat-label"},"今日充值笔数",-1)),n("div",St,[l(i(p.todayCount)+" ",1),t[12]||(t[12]=n("span",{class:"unit"},"笔",-1))])]),n("div",Nt,[t[14]||(t[14]=n("div",{class:"stat-label"},"本月充值金额",-1)),n("div",At,"R$ "+i(_(p.monthAmount)),1)]),n("div",$t,[t[15]||(t[15]=n("div",{class:"stat-label"},"笔均金额",-1)),n("div",Dt,"R$ "+i(_(p.avgAmount)),1)])]),n("div",It,[n("div",Rt,[e(g,{value:d.orderNo,"onUpdate:value":t[0]||(t[0]=s=>d.orderNo=s),placeholder:"订单号/用户ID","allow-clear":"",style:{width:"180px"}},{prefix:a(()=>[e(k(X))]),_:1},8,["value"]),e(E,{value:d.payChannel,"onUpdate:value":t[1]||(t[1]=s=>d.payChannel=s),placeholder:"支付通道","allow-clear":"",style:{width:"140px"}},{default:a(()=>[e(r,{value:"PIX"},{default:a(()=>[...t[16]||(t[16]=[l("PIX",-1)])]),_:1}),e(r,{value:"Boleto"},{default:a(()=>[...t[17]||(t[17]=[l("Boleto",-1)])]),_:1}),e(r,{value:"CreditCard"},{default:a(()=>[...t[18]||(t[18]=[l("Credit Card",-1)])]),_:1}),e(r,{value:"TED"},{default:a(()=>[...t[19]||(t[19]=[l("TED",-1)])]),_:1})]),_:1},8,["value"]),e(E,{value:d.status,"onUpdate:value":t[2]||(t[2]=s=>d.status=s),placeholder:"订单状态","allow-clear":"",style:{width:"140px"}},{default:a(()=>[e(r,{value:null},{default:a(()=>[...t[20]||(t[20]=[l("全部",-1)])]),_:1}),e(r,{value:0},{default:a(()=>[...t[21]||(t[21]=[l("待支付",-1)])]),_:1}),e(r,{value:1},{default:a(()=>[...t[22]||(t[22]=[l("处理中",-1)])]),_:1}),e(r,{value:2},{default:a(()=>[...t[23]||(t[23]=[l("成功",-1)])]),_:1}),e(r,{value:-1},{default:a(()=>[...t[24]||(t[24]=[l("已取消",-1)])]),_:1}),e(r,{value:-2},{default:a(()=>[...t[25]||(t[25]=[l("失败",-1)])]),_:1})]),_:1},8,["value"]),e(W,{value:y.value,"onUpdate:value":t[3]||(t[3]=s=>y.value=s),"value-format":"YYYY-MM-DD",style:{width:"260px"}},null,8,["value"])]),n("div",Ut,[e(c,{type:"primary",onClick:m},{icon:a(()=>[e(k(X))]),default:a(()=>[t[26]||(t[26]=l(" 查询 ",-1))]),_:1}),e(c,{onClick:q},{icon:a(()=>[e(k(rt))]),default:a(()=>[t[27]||(t[27]=l(" 重置 ",-1))]),_:1}),e(c,{onClick:Q},{icon:a(()=>[e(k(yt))]),default:a(()=>[t[28]||(t[28]=l(" 导出 ",-1))]),_:1})])]),n("div",Ot,[e(H,{"data-source":h.value,loading:I.value,pagination:!1,scroll:{x:1200}},{default:a(()=>[e(v,{title:"订单信息","data-index":"orderNo",width:160},{default:a(({record:s})=>[n("div",ht,i(s.orderNo||"R"+s.id),1)]),_:1}),e(v,{title:"用户信息",width:160},{default:a(({record:s})=>[n("div",Tt,[e(G,{size:36,src:s.userAvatar||Xt},{default:a(()=>{var b;return[l(i(((b=s.userNickname)==null?void 0:b.charAt(0))||"U"),1)]}),_:2},1032,["src"]),n("div",zt,[n("div",Bt,i(s.userNickname||"用户"+s.userId),1),n("div",Et,"ID: "+i(s.userId),1)])])]),_:1}),e(v,{title:"充值金额","data-index":"price",width:120,align:"right"},{default:a(({record:s})=>[n("span",null,"R$ "+i(_(s.price)),1)]),_:1}),e(v,{title:"实付金额",width:120,align:"right"},{default:a(({record:s})=>[n("span",Vt,"R$ "+i(_(s.payAmount||s.price)),1)]),_:1}),e(v,{title:"支付通道","data-index":"payChannel",width:110,align:"center"},{default:a(({record:s})=>[e(N,{color:Y(s.payChannel)},{default:a(()=>[l(i(s.payChannel||"PIX"),1)]),_:2},1032,["color"])]),_:1}),e(v,{title:"状态","data-index":"status",width:90,align:"center"},{default:a(({record:s})=>[e(N,{color:z(s.status)},{default:a(()=>[l(i(T(s.status)),1)]),_:2},1032,["color"])]),_:1}),e(v,{title:"支付时间","data-index":"payTime",width:160,align:"center"},{default:a(({record:s})=>[n("span",null,i(s.payTime||"-"),1)]),_:1}),e(v,{title:"创建时间","data-index":"createTime",width:160,align:"center"}),e(v,{title:"操作",width:80,align:"center",fixed:"right"},{default:a(({record:s})=>[e(c,{type:"link",onClick:b=>F(s)},{default:a(()=>[e(k(ft))]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data-source","loading"])]),n("div",Mt,[n("span",Pt,"共 "+i(R.value)+" 条记录",1),e(J,{current:d.pageNum,"onUpdate:current":t[4]||(t[4]=s=>d.pageNum=s),"page-size":d.pageSize,"onUpdate:pageSize":t[5]||(t[5]=s=>d.pageSize=s),total:R.value,"show-size-changer":!0,"page-size-options":["10","20","50","100"],"show-quick-jumper":"",onChange:m,onShowSizeChange:m},null,8,["current","page-size","total"])]),e(Z,{open:C.value,"onUpdate:open":t[10]||(t[10]=s=>C.value=s),title:"订单详情",width:"600px"},{footer:a(()=>{var s,b,V,M;return[e(c,{onClick:t[6]||(t[6]=U=>C.value=!1)},{default:a(()=>[...t[29]||(t[29]=[l("关闭",-1)])]),_:1}),((s=u.value)==null?void 0:s.status)===1?(S(),$(c,{key:0,type:"primary",onClick:t[7]||(t[7]=U=>B(u.value,2))},{default:a(()=>[...t[30]||(t[30]=[l(" 标记成功 ",-1)])]),_:1})):D("",!0),((b=u.value)==null?void 0:b.status)===1?(S(),$(c,{key:1,danger:"",onClick:t[8]||(t[8]=U=>B(u.value,-2))},{default:a(()=>[...t[31]||(t[31]=[l(" 标记失败 ",-1)])]),_:1})):D("",!0),((V=u.value)==null?void 0:V.payStatus)===1&&((M=u.value)==null?void 0:M.status)!==-3?(S(),$(c,{key:2,type:"default",onClick:t[9]||(t[9]=U=>L(u.value))},{default:a(()=>[...t[32]||(t[32]=[l(" 退款 ",-1)])]),_:1})):D("",!0)]}),default:a(()=>[u.value?(S(),$(K,{key:0,column:2,bordered:""},{default:a(()=>[e(f,{label:"订单号"},{default:a(()=>[l(i(u.value.orderNo),1)]),_:1}),e(f,{label:"用户ID"},{default:a(()=>[l(i(u.value.userId),1)]),_:1}),e(f,{label:"充值手机"},{default:a(()=>[l(i(u.value.mobile),1)]),_:1}),e(f,{label:"充值金额"},{default:a(()=>[l("R$ "+i(_(u.value.price)),1)]),_:1}),e(f,{label:"实付金额"},{default:a(()=>[l("R$ "+i(_(u.value.payAmount)),1)]),_:1}),e(f,{label:"支付状态"},{default:a(()=>[e(N,{color:u.value.payStatus===1?"success":""},{default:a(()=>[l(i(u.value.payStatus===1?"已支付":"未支付"),1)]),_:1},8,["color"])]),_:1}),e(f,{label:"订单状态"},{default:a(()=>[e(N,{color:z(u.value.status)},{default:a(()=>[l(i(T(u.value.status)),1)]),_:1},8,["color"])]),_:1}),e(f,{label:"创建时间"},{default:a(()=>[l(i(u.value.createTime),1)]),_:1})]),_:1})):D("",!0)]),_:1},8,["open"])])}}}),Qt=gt(Yt,[["__scopeId","data-v-b091a7c9"]]);export{Qt as default};
